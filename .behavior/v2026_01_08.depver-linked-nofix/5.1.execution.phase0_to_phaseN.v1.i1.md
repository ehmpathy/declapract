# execution tracking: depver-linked-nofix

## status: ✅ COMPLETE

all phases executed successfully. feature is ready for review.

---

## phase 1: create utility function ✅

### 1.1 create `isLinkedDependencyVersion` utility ✅
- file: `src/domain.operations/declaration/readPracticeDeclarations/readPracticeDeclaration/getFileCheckDeclaration/checkExpressions/check.minVersion.ts`
- function detects `link:` prefix on version strings
- returns `true` for: `link:.`, `link:..`, `link:../path`, `link:/absolute`
- returns `false` for: semver, other protocols, non-strings

### 1.2 create unit tests ✅
- file: `src/domain.operations/declaration/readPracticeDeclarations/readPracticeDeclaration/getFileCheckDeclaration/checkExpressions/check.minVersion.test.ts`
- 22 test cases covering:
  - linked versions (5 cases): `link:.`, `link:..`, `link:../sibling`, `link:/absolute`, `link:./nested`
  - semver versions (4 cases): `1.0.0`, `^1.0.0`, `~1.0.0`, `>=1.0.0`
  - other protocols (4 cases): `file:`, `git:`, `npm:`, `workspace:`
  - non-string values (5 cases): `null`, `undefined`, `number`, `object`, `array`
  - edge cases (4 cases): empty string, `link` without colon, uppercase `LINK`, leading space

---

## phase 2: update check logic ✅

### 2.1 update `checkDoesFoundValuePassesMinVersionCheck` ✅
- file: `src/domain.operations/declaration/readPracticeDeclarations/readPracticeDeclaration/getFileCheckDeclaration/checkExpressions/check.minVersion.ts`
- added early return for linked versions before semver check
- linked versions always pass minVersion checks (the repo IS the package)

### 2.2 add unit tests for check behavior ✅
- file: `src/domain.operations/declaration/readPracticeDeclarations/readPracticeDeclaration/getFileCheckDeclaration/checkExpressions/check.minVersion.test.ts`
- 10 additional test cases for `checkDoesFoundValuePassesMinVersionCheck`:
  - linked versions (4 cases): all pass regardless of minVersion
  - semver versions (3 cases): meets minimum, equals minimum, caret range fails
  - non-string values (3 cases): null, undefined, number all fail

### 2.3 add tests for `checkContainsJSON` ✅
- file: `src/domain.operations/declaration/readPracticeDeclarations/readPracticeDeclaration/getFileCheckDeclaration/checkMethods/composableActions/checkContainsJSON.test.ts`
- 2 new test cases:
  - `link:.` passes minVersion check
  - `link:../shared-utils` passes minVersion check

---

## phase 3: update fix logic ✅

### 3.1 update fix logic ✅
- file: `src/domain.operations/declaration/readPracticeDeclarations/readPracticeDeclaration/getFileCheckDeclaration/fixMethods/fixContainsJSONByReplacingAndAddingKeyValues.ts`
- **no changes needed** - fix logic already uses `checkDoesFoundValuePassesMinVersionCheck`
- since that function now returns `true` for linked versions, fix automatically preserves them
- key code path (lines 60-72):
  ```ts
  if (isCheckMinVersionExpression(desiredValue)) {
    const minVersion = getMinVersionFromCheckMinVersionExpression(desiredValue);
    const passesMinVersion = checkDoesFoundValuePassesMinVersionCheck({
      foundValue: currentValue,
      minVersion,
    });
    if (passesMinVersion) return currentValue; // preserves linked versions
    return minVersion;
  }
  ```

### 3.2 add unit tests for fix logic ✅
- file: `src/domain.operations/declaration/readPracticeDeclarations/readPracticeDeclaration/getFileCheckDeclaration/fixMethods/fixContainsJSONByReplacingAndAddingKeyValues.test.ts`
- 2 new test cases:
  - `link:.` preserved in dependencies with minVersion check
  - `link:../shared-utils` preserved in devDependencies with minVersion check

---

## phase 4: validation ✅

### 4.1 type check ✅
```
npm run test:types
# passed - no output = success
```

### 4.2 lint check ✅
```
npm run test:lint
# Checked 132 files in 1041ms. No issues found.
# No depcheck issue
```

### 4.3 unit tests ✅
```
npm run test:unit
# Test Suites: 6 passed, 6 total
# Tests:       48 passed, 48 total
# Snapshots:   3 passed, 3 total
```

key test files and results:
- `check.minVersion.test.ts`: 32 passed
- `fixContainsJSONByReplacingAndAddingKeyValues.test.ts`: 7 passed
- `checkContainsJSON.test.ts`: 6 passed
- sdk tests: 3 passed

### 4.4 integration tests ✅
```
npm run test:integration
# Test Suites: 14 passed, 14 total
# Tests:       9 skipped, 1 todo, 43 passed, 53 total
# Snapshots:   34 passed, 34 total
```

---

## summary

### files modified
1. `check.minVersion.ts` - added `isLinkedDependencyVersion` utility and updated `checkDoesFoundValuePassesMinVersionCheck`
2. `check.minVersion.test.ts` - added 32 tests for linked version behavior
3. `checkContainsJSON.test.ts` - added 2 tests for linked version check behavior
4. `fixContainsJSONByReplacingAndAddingKeyValues.test.ts` - added 2 tests for linked version fix behavior

### behavior change
- `@declapract{check.minVersion('x.y.z')}` now recognizes `link:*` versions as always valid
- fix logic preserves linked versions instead of substitution with semver
- rationale: `link:.` indicates the repo IS that package, so by definition it's already satisfied

### test coverage
- 48 unit tests pass
- 43 integration tests pass
- all new behavior is covered by explicit test cases
